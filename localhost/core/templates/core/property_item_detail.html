{% extends "core/base.html" %}

{% block title %} {{ block.super }} - {{ property_item.title }} {% endblock %}

{% block body_wrapped %}
{% include "core/include/header.html" %}
  <div class="container d-flex flex-column flex-grow-1 justify-content-center">
    <div class="row mt-3">
      <div class="col-lg-8">
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
            {% for image in property_item.images.all %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <img class="d-block w-100" src="{{ image.img.url }}">
              </div>
            {% endfor %}
          </div>
          <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
        <div class="p-2">
          <h2 class="m-0">{{ property_item.title }}</h2>
        </div>
        <div class="justify-content-center algin-items-center">
          <div class=" btn-group p-2">
            <a href="{% url 'core:property-detail' property_item.property.id %}" role="button" class="btn btn-secondary">Property</a>
            {% for item in property_item.property.property_item.all %}
              <a href="" role="button" class="btn btn-secondary">{{ item.title }}</a>
            {% endfor %}
          </div>
        </div>
        <div class="p-2">
          <h4>Description</h4>
          {{ property_item.description }}
        </div>
        <div class="p-2">
          <h4>Amenities</h4>
          {% for amenity in property_item.amenities.all %}
          <i class="fas {{ amenity.icon|safe }}"></i>
          {% endfor %}
        </div>
      </div>
      <div class="col-lg-4">
        <div class="row m-0 my-3 justify-content-center">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Bidding</h5>
              <p id="card-text" class="card-text" value="2">Current bid: $150</p>
              <button id="bid" class="btn btn-primary">Bid! (+$5)</button>
            </div>
          </div>
        </div>
        <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
        <script>
    var roomName = {{ property_item.id }};

    var chatSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/property-detail/' + roomName + '/');

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];
        document.querySelector('#card-text').value = message + '\n';
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#bid').onclick = function(e) {
        // var messageInputDom = document.querySelector('#card-text');
        //console.log(messageInputDom);
        //var message = messageInputDom.value;
        //console.log(message);
        var target = $('#card-text');
        var message = target.text();
        console.log(message);
        chatSocket.send(JSON.stringify({
            'message': message
        }));
    };
        </script>
      </div>
    </div>
  </div>
{% include "core/include/footer.html" %}
{% endblock %}
