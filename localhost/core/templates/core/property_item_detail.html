{% extends "core/base.html" %}
{% load static %}

{% block css %}
<link rel="stylesheet" type="text/css" href="{% static "core/css/components/header.css" %}">
<link rel="stylesheet" type="text/css" href="{% static "core/css/components/footer.css" %}">
<link rel="stylesheet" type="text/css" href="{% static "core/css/property.css" %}">
{% endblock %}

{% block body_wrapped %}
{% include "core/include/header.html" %}
<div class="container">
  <div class="row">
    <!-- Property details modules -->
    <div class="col-md-8">
      <!-- Slideshow -->
      <div class="flex-row">
        <div id="slideshow" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="d-block w-100" src="https://a0.muscache.com/4ea/air/v2/pictures/fc8e5efc-16ab-4ac7-8d5e-6570645e9355.jpg" alt="First slide">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="https://a0.muscache.com/4ea/air/v2/pictures/fc8e5efc-16ab-4ac7-8d5e-6570645e9355.jpg" alt="Second slide">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="https://a0.muscache.com/4ea/air/v2/pictures/fc8e5efc-16ab-4ac7-8d5e-6570645e9355.jpg" alt="Third slide">
            </div>
          </div>
          <a class="carousel-control-prev" href="#slideshow" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#slideshow" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>

      <!-- Description and amneties -->
      <div class="flex-row">
        <div class="card flex-md-row mb-4 h-md-250">
          <div class="card-body d-flex flex-column align-items-start">
            <h3>{{ property_item.title }}</h3>
            <p>{{ property_item.description }}</p>
          </div>
        </div>
      </div>

      <!-- Reviews -->
      <div class="flex-row">
        <div class="card flex-md-row mb-4 h-md-250">
          <div class="card-body d-flex flex-column align-items-start">
            <h3>Reviews</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Bidding and contact modules -->
    <div class="col-md-4">
      <div class="flex-row">
        <!-- Available banner -->
        <div class="success-banner card flex-md-row">
          <div class="card-body d-flex flex-column align-items-center">
            <strong class="d-inline-block">3 Bookings Available</strong>
          </div>
        </div>
        <!-- Room selection -->
        <div class="card flex-md-row mb-4 h-md-250">
          <div class="card-body d-flex flex-column align-items-center">
            <div class="btn-group">
              <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Select A Booking
              </button>
              <div class="dropdown-menu">
                {% for item in property.property_item.all %}
                <a class="dropdown-item" href="{{ item.get_absolute_url }}">{{ item.title }}</a>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Registered Sessions -->
      <div class="flex-row">
        <div class="success-banner card flex-md-row">
          <div class="card-body d-flex flex-column align-items-center">
            <strong class="d-inline-block">Booking name</strong>
            <button type="button" class="btn dropdown-toggle mb-0" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Registered Sessions
            </button>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="#">12PM - 6PM</a>
              <a class="dropdown-item" href="#">6PM - 8PM</a>
              <a class="dropdown-item" href="#">8PM - 10PM</a>
            </div>
          </div>
        </div>
        <div class="card flex-md-row h-md-250">
          <div class="card-body d-flex flex-column align-items-center">
            <strong class="d-inline-block mx-2 text-success text-uppercase">Auction Ends In</strong>
            <strong id="countdown" class="d-inline-block mb-2 text-warning text-uppercase"></strong>
            <h3>Current bid: $<span id="bid-current">{{ current_price }}</span></h3>
            <small class="small"><span id="highest-bidder">{{ highest_bidder }}</span> has the highest bid!</small>
          </div>
        </div>
        <div class="card flex-md-row">
          <div class="card-body d-flex flex-column align-items-center">
            <strong class="d-inline-block">Place Bid</strong>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text">$</span>
              </div>
              <input id="bid-amount" type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
              <div class="input-group-append">
                <span class="input-group-text">.00</span>
              </div>
              <button id="bid-place" type="button" class="btn btn-success mb-0">Place</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% include "core/include/footer.html" %}
{% endblock %}
{% block js %}
<script type="text/javascript" src="{% static "core/js/countdown.js" %}"></script>
<script type="text/javascript" src="{% static "core/js/msocket/msocket.js" %}"></script>
<script>
  var session_end = new Date('Dec 17, 2018 13:00:00').getTime();
  register_countdown('countdown', session_end, 'CLOSED');
</script>
<script>
  var roomName = {{ property_item.id }};
  var msocket = new MSocket('ws://' + window.location.host + '/ws/realtime/');
  msocket.open();

  var handler = function(data) {
    var new_bid = data.amount;
    $('#bid-current').text(new_bid);
  }
  msocket.register_handler('bid', handler);

  var data = {
    'group': roomName
  }
  msocket.send('subscribe', data);

  $('#bid-place').click(function() {
    var amount = $('#bid-amount').val();
    if (amount) {
      if (!isNaN(amount)) {
        /* Send bid */
        var bid_data = {
          'property_item_id': roomName,
          'amount': amount
        }
        msocket.send('bid', bid_data);
      }
    }
  });

</script>
{% endblock %}
